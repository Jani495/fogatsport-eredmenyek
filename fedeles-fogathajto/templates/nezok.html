<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Fedeles Fogathajt√≥ - N√©z≈ëk</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 10px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
            color: #ffd700;
        }
        
        .header h2 {
            font-size: 1.3em;
            font-weight: normal;
        }
        
        .frissites-info {
            font-size: 0.9em;
            color: #ccc;
            margin-top: 10px;
        }
        
        /* Kateg√≥ria k√°rty√°k */
        .kategoria-card {
            background: #16213e;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .kategoria-title {
            color: #ffd700;
            font-size: 1.5em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #ffd700;
        }
        
        /* Fordul√≥ grid */
        .fordulo-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        @media (min-width: 768px) {
            .fordulo-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* Fordul√≥ k√°rty√°k */
        .fordulo-card {
            background: #0f3460;
            border-radius: 12px;
            padding: 15px;
            transition: transform 0.2s;
        }
        
        .fordulo-card:hover {
            transform: translateY(-3px);
        }
        
        .fordulo-card h3 {
            color: #ffd700;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 8px;
            border-bottom: 1px solid #ffd700;
        }
        
        .fordulo-card.f1 { border-left: 4px solid #2196F3; }
        .fordulo-card.f2 { border-left: 4px solid #ff9800; }
        .fordulo-card.ov { border-left: 4px solid #4CAF50; }
        
        /* Versenyz≈ë sorok */
        .versenyzo-sor {
            display: grid;
            grid-template-columns: auto 1fr auto auto auto;
            gap: 8px;
            align-items: center;
            padding: 10px;
            margin-bottom: 6px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            font-size: 0.95em;
            transition: background 0.2s;
        }
        
        .versenyzo-sor:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .versenyzo-sor.helyezes-1 { 
            background: rgba(255,215,0,0.2);
            border-left: 3px solid gold;
        }
        .versenyzo-sor.helyezes-2 { 
            background: rgba(192,192,192,0.2);
            border-left: 3px solid silver;
        }
        .versenyzo-sor.helyezes-3 { 
            background: rgba(205,127,50,0.2);
            border-left: 3px solid #cd7f32;
        }
        
        .versenyzo-sor.feladta {
            background: rgba(255,152,0,0.1);
            border-left: 3px solid #ff9800;
            opacity: 0.8;
        }
        
        .versenyzo-sor.kiz√°rva {
            background: rgba(244,67,54,0.1);
            border-left: 3px solid #f44336;
            opacity: 0.8;
        }
        
        /* St√°tusz badge */
        .statusz-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .statusz-feladta {
            background: #ff9800;
            color: white;
        }
        
        .statusz-kiz√°rva {
            background: #f44336;
            color: white;
        }
        
        /* Oszlopok */
        .startszam {
            font-weight: bold;
            color: #ffd700;
            font-size: 1.1em;
            min-width: 45px;
        }
        
        .nev {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .nemzetiseg {
            font-size: 0.85em;
            color: #aaa;
            min-width: 30px;
        }
        
        .hiba {
            font-weight: bold;
            color: #ff6b6b;
            text-align: right;
            min-width: 45px;
        }
        
        .ido {
            font-family: monospace;
            color: #4CAF50;
            text-align: right;
            min-width: 75px;
        }
        
        /* Nincs eredm√©ny */
        .nincs-eredmeny {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
        }
        
        /* L√°bl√©c */
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.85em;
        }
        
        .megjegyzes {
            font-size: 0.9em;
            color: #aaa;
            margin: 15px 0;
            text-align: center;
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
        }
        
        /* Hiba √ºzenet */
        .hiba-uzenet {
            background: #f44336;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        /* Bet√∂lt√©s anim√°ci√≥ */
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
        
        /* Reszponz√≠v */
        @media (max-width: 480px) {
            .header h1 { font-size: 1.5em; }
            .kategoria-title { font-size: 1.2em; }
            .versenyzo-sor { 
                font-size: 0.85em;
                grid-template-columns: auto 1fr auto auto auto;
            }
            .ido { min-width: 65px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèÜ FEDELES FOGATHAJT√ì VERSENY üèÜ</h1>
            <h2 id="verseny-cim">Bet√∂lt√©s...</h2>
            <div class="frissites-info">
                üîÑ Automatikus friss√≠t√©s 5 m√°sodpercenk√©nt
                <br>
                <span id="utolsoFrissites"></span>
            </div>
        </div>

        <!-- Itt jelennek meg a kateg√≥ri√°k -->
        <div id="kategoriak-container">
            <div class="kategoria-card" style="text-align: center; padding: 40px;">
                <div class="loading">Adatok bet√∂lt√©se...</div>
            </div>
        </div>

        <!-- Megjegyz√©s -->
        <div class="megjegyzes">
            * A sorrend: El≈ësz√∂r a 0 hibapontosok (id≈ë szerint),<br>
            majd a hibapontosok (hiba majd id≈ë), legv√©g√ºl a feladta/kiz√°rta versenyz≈ëk
        </div>

        <!-- Footer -->
        <div class="footer">
            ¬© 2026 Fedeles Fogathajt√≥ Versenyrendszer
        </div>
    </div>

    <script>
        // URL-b≈ël verseny ID kinyer√©se
        const pathArray = window.location.pathname.split('/');
        const versenyId = pathArray[pathArray.length - 1];
        
        console.log('Verseny ID:', versenyId);

        let utolsoFrissites = new Date();

        // Id≈ë form√°z√°sa
        function formazIdo(ido) {
            if (!ido || ido === 0 || ido === '--:--' || ido >= 999999) return '--:--';
            if (typeof ido === 'string') return ido;
            return ido.toFixed(2) + ' mp';
        }

        // St√°tusz megjelen√≠t√©se
        function getStatuszHtml(statusz) {
            if (!statusz) return '';
            if (statusz === 'feladta') {
                return '<span class="statusz-badge statusz-feladta">‚ö†Ô∏è FELADTA</span>';
            }
            if (statusz === 'kiz√°rva') {
                return '<span class="statusz-badge statusz-kiz√°rva">üö´ KIZ√ÅRVA</span>';
            }
            return '';
        }

        // Rendez√©s f√ºggv√©ny a helyes sorrendhez
        function rendezes(lista) {
            // Sz√©tv√°laszt√°s st√°tusz szerint
            const normal = lista.filter(v => !v.statusz || v.statusz === '');
            const feladta = lista.filter(v => v.statusz === 'feladta');
            const kizarva = lista.filter(v => v.statusz === 'kiz√°rva');
            
            // Norm√°l versenyz≈ëk rendez√©se
            const nullaHibas = normal.filter(v => v.hiba === 0);
            const hibas = normal.filter(v => v.hiba > 0);
            
            // 0 hib√°sak id≈ë szerint (gyorsabb jobb)
            const nullaRendezett = nullaHibas.sort((a, b) => a.ido - b.ido);
            
            // Hib√°sak rendez√©se (hiba szerint, majd id≈ë)
            const hibasRendezett = hibas.sort((a, b) => {
                if (a.hiba !== b.hiba) return a.hiba - b.hiba;
                return a.ido - b.ido;
            });
            
            return [...nullaRendezett, ...hibasRendezett, ...feladta, ...kizarva];
        }

        // Adatok friss√≠t√©se
        function frissitEredmenyek() {
            fetch('/api/nezok_adatok/' + versenyId)
                .then(response => {
                    console.log('V√°lasz st√°tusz:', response.status);
                    if (!response.ok) {
                        throw new Error('H√°l√≥zati hiba: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Kapott adatok:', data);
                    
                    // Verseny c√≠m friss√≠t√©se
                    document.getElementById('verseny-cim').textContent = 
                        (data.verseny_neve || 'Ismeretlen verseny') + ' - ' + (data.verseny_datum || '');
                    
                    const container = document.getElementById('kategoriak-container');
                    container.innerHTML = '';
                    
                    // Ha nincs kateg√≥ria
                    if (!data.kategoriak || Object.keys(data.kategoriak).length === 0) {
                        container.innerHTML = '<div class="kategoria-card">M√©g nincsenek versenyz≈ëk ebben a versenyben.</div>';
                        return;
                    }
                    
                    // Kateg√≥ri√°k feldolgoz√°sa
                    for (const [kategoria, fordulok] of Object.entries(data.kategoriak)) {
                        const kategoriaDiv = document.createElement('div');
                        kategoriaDiv.className = 'kategoria-card';
                        
                        let html = `<div class="kategoria-title">üìã ${kategoria}</div>`;
                        html += '<div class="fordulo-grid">';
                        
                        // 1. Fordul√≥
                        html += '<div class="fordulo-card f1">';
                        html += '<h3>üîµ 1. FORDUL√ì</h3>';
                        
                        if (fordulok.f1_minden && fordulok.f1_minden.length > 0) {
                            const rendezett = rendezes(fordulok.f1_minden);
                            
                            rendezett.forEach((v, index) => {
                                const helyezesClass = index < 3 ? `helyezes-${index + 1}` : '';
                                const statuszClass = v.statusz ? v.statusz : '';
                                
                                html += `
                                    <div class="versenyzo-sor ${helyezesClass} ${statuszClass}">
                                        <span class="startszam">#${v.startszam}</span>
                                        <span class="nev">${v.nev || '?'}</span>
                                        <span class="nemzetiseg">${v.nemzetiseg || '?'}</span>
                                        <span class="hiba">
                                            ${v.statusz ? getStatuszHtml(v.statusz) : (v.hiba === 0 ? '0' : v.hiba)}
                                        </span>
                                        <span class="ido">${v.statusz ? '--:--' : formazIdo(v.ido_raw)}</span>
                                    </div>
                                `;
                            });
                        } else {
                            html += '<div class="nincs-eredmeny">M√©g nincs eredm√©ny</div>';
                        }
                        html += '</div>';
                        
                        // 2. Fordul√≥
                        html += '<div class="fordulo-card f2">';
                        html += '<h3>üü† 2. FORDUL√ì</h3>';
                        
                        if (fordulok.f2_minden && fordulok.f2_minden.length > 0) {
                            const rendezett = rendezes(fordulok.f2_minden);
                            
                            rendezett.forEach((v, index) => {
                                const helyezesClass = index < 3 ? `helyezes-${index + 1}` : '';
                                const statuszClass = v.statusz ? v.statusz : '';
                                
                                html += `
                                    <div class="versenyzo-sor ${helyezesClass} ${statuszClass}">
                                        <span class="startszam">#${v.startszam}</span>
                                        <span class="nev">${v.nev || '?'}</span>
                                        <span class="nemzetiseg">${v.nemzetiseg || '?'}</span>
                                        <span class="hiba">
                                            ${v.statusz ? getStatuszHtml(v.statusz) : (v.hiba === 0 ? '0' : v.hiba)}
                                        </span>
                                        <span class="ido">${v.statusz ? '--:--' : formazIdo(v.ido_raw)}</span>
                                    </div>
                                `;
                            });
                        } else {
                            html += '<div class="nincs-eredmeny">M√©g nincs eredm√©ny</div>';
                        }
                        html += '</div>';
                        
                        // √ñsszevet√©s
                        html += '<div class="fordulo-card ov">';
                        html += '<h3>üü¢ √ñSSZEVET√âS</h3>';
                        
                        if (fordulok.ov && fordulok.ov.length > 0) {
                            const rendezett = rendezes(fordulok.ov);
                            
                            rendezett.forEach((v, index) => {
                                const helyezesClass = index < 3 ? `helyezes-${index + 1}` : '';
                                const statuszClass = v.statusz ? v.statusz : '';
                                
                                html += `
                                    <div class="versenyzo-sor ${helyezesClass} ${statuszClass}">
                                        <span class="startszam">#${v.startszam}</span>
                                        <span class="nev">${v.nev || '?'}</span>
                                        <span class="nemzetiseg">${v.nemzetiseg || '?'}</span>
                                        <span class="hiba">
                                            ${v.statusz ? getStatuszHtml(v.statusz) : (v.hiba === 0 ? '0' : v.hiba)}
                                        </span>
                                        <span class="ido">${v.statusz ? '--:--' : formazIdo(v.ido_raw)}</span>
                                    </div>
                                `;
                            });
                        } else {
                            html += '<div class="nincs-eredmeny">M√©g nincs √∂sszevet√©s</div>';
                        }
                        html += '</div>';
                        
                        html += '</div>'; // fordulo-grid v√©ge
                        kategoriaDiv.innerHTML = html;
                        container.appendChild(kategoriaDiv);
                    }
                    
                    // Utols√≥ friss√≠t√©s id≈ëpontja
                    utolsoFrissites = new Date();
                    document.getElementById('utolsoFrissites').innerHTML = 
                        `Utols√≥ friss√≠t√©s: ${utolsoFrissites.toLocaleTimeString('hu-HU')}`;
                })
                .catch(error => {
                    console.error('R√©szletes hiba:', error);
                    document.getElementById('kategoriak-container').innerHTML = 
                        `<div class="hiba-uzenet">
                            ‚ùå Hiba az adatok bet√∂lt√©se k√∂zben<br>
                            <small>${error.message}</small><br>
                            <button onclick="frissitEredmenyek()" style="margin-top: 15px; padding: 8px 16px; background: white; border: none; border-radius: 5px; cursor: pointer;">
                                √öjrapr√≥b√°lkoz√°s
                            </button>
                        </div>`;
                });
        }

        // Els≈ë bet√∂lt√©s
        frissitEredmenyek();
        
        // Automatikus friss√≠t√©s 5 m√°sodpercenk√©nt
        setInterval(frissitEredmenyek, 5000);
    </script>
</body>
</html>